// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  passwordHash  String
  role          String    @default("client") // client, admin, team
  image         String?
  company       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  projects      Project[]
  automations   Automation[]
  sessions      Session[]

  @@map("users")
}

// Session model for NextAuth
model Session {
  id           String   @id @default(uuid())
  userId       String
  expires      DateTime
  sessionToken String   @unique
  accessToken  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// Projects (client projects)
model Project {
  id          String   @id @default(uuid())
  title       String
  description String?
  status      String   @default("active") // active, paused, completed
  userId      String
  serviceType String   // automation, marketing, saas-ai, branding, strategy
  startDate   DateTime @default(now())
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  automations Automation[]

  @@map("projects")
}

// Automation workflows
model Automation {
  id          String   @id @default(uuid())
  title       String
  description String?
  flow        String   // JSON string of nodes and edges
  status      String   @default("draft") // draft, active, paused
  userId      String
  projectId   String?
  runs        Int      @default(0)
  lastRun     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project     Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@map("automations")
}

// Leads (from contact form)
model Lead {
  id          String   @id @default(uuid())
  name        String
  email       String
  company     String
  challenge   String
  source      String   // landing-page, service-page, etc.
  status      String   @default("new") // new, contacted, qualified, converted
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("leads")
}
